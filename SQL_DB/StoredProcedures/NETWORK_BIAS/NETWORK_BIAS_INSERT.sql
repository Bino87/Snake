CREATE PROCEDURE [dbo].[NETWORK_BIAS_INSERT]
	@ID INT OUTPUT,
	@INTERNAL_INDEX INT,
	@VALUE FLOAT,
	@LAYER_ID INT
AS
BEGIN
	SET NOCOUNT ON

	IF NOT EXISTS(SELECT TOP 1 1 FROM NETWORK_VALUES V WHERE  V.VALUE = @VALUE)
		BEGIN

			DECLARE @NEW_ID INT;
			INSERT INTO NETWORK_VALUES (VALUE)
			VALUES(@VALUE)
			SET @NEW_ID = SCOPE_IDENTITY()

			INSERT INTO NETWORK_BIAS VALUES(@INTERNAL_INDEX, @NEW_ID, @LAYER_ID)
			SET @ID = SCOPE_IDENTITY();
			RETURN @ID
		END
	ELSE 
		BEGIN
			INSERT INTO NETWORK_BIAS (INTERNAL_INDEX, LAYER_ID, VALUE_ID)
			SELECT TOP(1) @INTERNAL_INDEX,@LAYER_ID,Id FROM NETWORK_VALUES V WHERE  V.VALUE = @VALUE

		END
END
